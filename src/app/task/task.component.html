<mat-tab-group>
    <mat-tab label="All Tasks">
        <mat-accordion>
            <!-- <mat-card>Title :: Due Date</mat-card> -->
            <div *ngFor="let task of tasks$">
            <mat-expansion-panel>
                
                <mat-expansion-panel-header class="{{task.status}}">
                    <mat-panel-title><p class="{{task.status}}_text">{{ task.title }}</p></mat-panel-title>
                    <mat-panel-description *ngIf="task.dueDate != null">
                        <p class="{{task.status}}_text">{{ toDateObj(task.dueDate).toDateString() }}</p></mat-panel-description>       
                </mat-expansion-panel-header>

                <h2>{{ TASK_TYPE_CODES_MAP.get(task.type) + " -> " + task.title}}</h2>
                <h3 *ngIf="task.status != undefined">Status -> {{ TASK_STATUS_CODES_MAP.get(task.status) }}</h3>
                <h3 *ngIf="task.startDate != undefined">Start date -> {{ toDateObj(task.startDate).toDateString() }}</h3>
                <h3 *ngIf="task.dueDate != undefined">Due date -> {{ toDateObj(task.dueDate).toDateString() }}</h3>
                <h3 *ngIf="task.completedDate != undefined">Date completed -> {{ toDateObj(task.completedDate).toDateString() }}</h3>
                <h4>{{ task.description }}</h4>
               
                <form [formGroup]="taskForm">
                    <mat-form-field appearance="outline">
                        <mat-label>Rename</mat-label>
                        <input matInput [placeholder]="task.title" type="text" name="task-name" formControlName="task-name">
                    </mat-form-field>
        
                    <mat-divider></mat-divider>
        
                    <mat-form-field appearance="outline">
                        <mat-label>Category</mat-label>
                        <input matInput [placeholder]="task.category" type="text" name="task-category" formControlName="task-category">
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Details</mat-label>
                        <input matInput [placeholder]="task.description" type="text" name="task-details" formControlName="task-details">
                    </mat-form-field>
        
                    <mat-divider></mat-divider>
                    
                    <mat-form-field appearance="outline">
                        <mat-label>Status</mat-label>
                        <mat-select matNativeControl formControlName="task-status">
                            <mat-option *ngFor="let enum of TASK_STATUS_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                        </mat-select>
                    </mat-form-field> 
                    <mat-form-field appearance="outline">
                        <mat-label>Type</mat-label>
                        <mat-select matNativeControl formControlName="task-type">
                            <mat-option *ngFor="let enum of TASK_TYPE_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                        </mat-select>
                    </mat-form-field> 
                
                    <mat-divider></mat-divider>
        
                    <mat-form-field>
                        <input matInput [matDatepicker]="startDatePicker" name="task-start-date" formControlName="task-start-date">
                        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                        <mat-label>Task Start Date</mat-label>
                        <mat-datepicker #startDatePicker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput [matDatepicker]="endDatePicker" name="task-due-date" formControlName="task-due-date">
                        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                        <mat-label>Due Date</mat-label>
                        <mat-datepicker #endDatePicker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput [matDatepicker]="completeDatePicker" name="task-complete-date" formControlName="task-complete-date">
                        <mat-datepicker-toggle matSuffix [for]="completeDatePicker"></mat-datepicker-toggle>
                        <mat-label>Completion Date</mat-label>
                        <mat-datepicker #completeDatePicker></mat-datepicker>
                    </mat-form-field>
                </form>

                <mat-action-row>   
                    <button mat-raised-button (click)="updateTask(task.id)">Save and Update!</button> 
                    <button mat-button (click)="deleteTask(task.id)">Delete</button>
                </mat-action-row>
            
            </mat-expansion-panel>
            </div>
        </mat-accordion>

    </mat-tab>
    <mat-tab *ngFor="let tab of categories$" [label]="tab">
        <mat-accordion>
            <div *ngFor="let task of tasks$">
            <mat-expansion-panel *ngIf="task.category === tab">
                
                <mat-expansion-panel-header class="{{task.status}}">
                    <mat-panel-title><p class="{{task.status}}_text">{{ task.title }}</p></mat-panel-title>
                    <mat-panel-description *ngIf="task.dueDate != null">
                        <p class="{{task.status}}_text">{{ toDateObj(task.dueDate).toDateString() }}</p></mat-panel-description>       
                </mat-expansion-panel-header>

                <h2>{{ TASK_TYPE_CODES_MAP.get(task.type) + " -> " + task.title}}</h2>
                <h3 *ngIf="task.status != undefined">Status -> {{ TASK_STATUS_CODES_MAP.get(task.status) }}</h3>
                <h3 *ngIf="task.startDate != undefined">Start date -> {{ toDateObj(task.startDate).toDateString() }}</h3>
                <h3 *ngIf="task.dueDate != undefined">Due date -> {{ toDateObj(task.dueDate).toDateString() }}</h3>
                <h3 *ngIf="task.completedDate != undefined">Date completed -> {{ toDateObj(task.completedDate).toDateString() }}</h3>
                <h4>{{ task.description }}</h4>
               
                <form [formGroup]="taskForm">
                    <mat-form-field appearance="outline">
                        <mat-label>Rename</mat-label>
                        <input matInput [placeholder]="task.title" type="text" name="task-name" formControlName="task-name">
                    </mat-form-field>
        
                    <mat-divider></mat-divider>
        
                    <mat-form-field appearance="outline">
                        <mat-label>Category</mat-label>
                        <input matInput [placeholder]="task.category" type="text" name="task-category" formControlName="task-category">
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Details</mat-label>
                        <input matInput [placeholder]="task.description" type="text" name="task-details" formControlName="task-details">
                    </mat-form-field>
        
                    <mat-divider></mat-divider>
                    
                    <mat-form-field appearance="outline">
                        <mat-label>Status</mat-label>
                        <mat-select matNativeControl formControlName="task-status">
                            <mat-option *ngFor="let enum of TASK_STATUS_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                        </mat-select>
                    </mat-form-field> 
                    <mat-form-field appearance="outline">
                        <mat-label>Type</mat-label>
                        <mat-select matNativeControl formControlName="task-type">
                            <mat-option *ngFor="let enum of TASK_TYPE_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                        </mat-select>
                    </mat-form-field> 
                
                    <mat-divider></mat-divider>
        
                    <mat-form-field>
                        <input matInput [matDatepicker]="startDatePicker" name="task-start-date" formControlName="task-start-date">
                        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                        <mat-label>Task Start Date</mat-label>
                        <mat-datepicker #startDatePicker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput [matDatepicker]="endDatePicker" name="task-due-date" formControlName="task-due-date">
                        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                        <mat-label>Due Date</mat-label>
                        <mat-datepicker #endDatePicker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput [matDatepicker]="completeDatePicker" name="task-complete-date" formControlName="task-complete-date">
                        <mat-datepicker-toggle matSuffix [for]="completeDatePicker"></mat-datepicker-toggle>
                        <mat-label>Completion Date</mat-label>
                        <mat-datepicker #completeDatePicker></mat-datepicker>
                    </mat-form-field>
                </form>

                <mat-action-row>   
                    <button mat-raised-button (click)="updateTask(task.id)">Save and Update!</button> 
                    <button mat-button (click)="deleteTask(task.id)">Delete</button>
                </mat-action-row>
            
            </mat-expansion-panel>
            </div>
        </mat-accordion>
    </mat-tab>
</mat-tab-group>

<mat-accordion >
    <mat-expansion-panel style="margin-top: 10%">
        <mat-expansion-panel-header>View Task Table</mat-expansion-panel-header> 

        <table 
            style="margin-bottom: 5%"
            mat-table 
            [dataSource]="dataSource" 
            matSort
            #taskTableSort="matSort" 
            matSortChange="announceSortChange($event)"
            class="mat-elevation-z8">

        <!-- Position Column -->
        <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by category">
            Category
            </th>
            <td mat-cell *matCellDef="let element"> {{ element.category }} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by name">
            Title
            </th>
            <td mat-cell *matCellDef="let element"> {{element.title}} </td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
            Status
            </th>
            <td mat-cell *matCellDef="let element"> {{ TASK_STATUS_CODES_MAP.get(element.status) }} </td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="dueDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by due date">
            Due Date
            </th>
            <td mat-cell *matCellDef="let element"> 
                <p *ngIf="element.dueDate != null">
                {{ toDateObj(element.dueDate).toDateString() }} </p>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        
    </mat-expansion-panel>
    <mat-expansion-panel> <!-- ADD TASK-->
        <mat-expansion-panel-header>Add Task</mat-expansion-panel-header>

        <form [formGroup]="taskForm">
            <mat-form-field appearance="outline">
                <mat-label>Task Name</mat-label>
                <input matInput type="text" name="task-name" formControlName="task-name" required="true">
            </mat-form-field>

            <mat-divider></mat-divider>

            <mat-form-field appearance="outline">
                <mat-label>Category</mat-label>
                <input matInput type="text" name="task-category" formControlName="task-category">
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Details</mat-label>
                <input matInput type="text" name="task-details" formControlName="task-details">
            </mat-form-field>

            <mat-divider></mat-divider>
            
            <mat-form-field appearance="outline">
                <mat-label>Status</mat-label>
                <mat-select matNativeControl formControlName="task-status">
                    <mat-option *ngFor="let enum of TASK_STATUS_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                </mat-select>
            </mat-form-field> 
            <mat-form-field appearance="outline">
                <mat-label>Type</mat-label>
                <mat-select matNativeControl formControlName="task-type">
                    <mat-option *ngFor="let enum of TASK_TYPE_CODES" [value]="enum.enum">{{ enum.friendly }}</mat-option>
                </mat-select>
            </mat-form-field> 
        
            <mat-divider></mat-divider>

            <mat-form-field>
                <input matInput [matDatepicker]="startDatePicker" name="task-start-date" formControlName="task-start-date">
                <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                <mat-label>Task Start Date</mat-label>
                <mat-datepicker #startDatePicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field>
                <input matInput [matDatepicker]="endDatePicker" name="task-due-date" formControlName="task-due-date">
                <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                <mat-label>Due Date</mat-label>
                <mat-datepicker #endDatePicker></mat-datepicker>
            </mat-form-field>

        </form>

        <mat-action-row>
            <button mat-raised-button (click)="addTaskRequest()">New Task</button>
        </mat-action-row>
    </mat-expansion-panel>
</mat-accordion>